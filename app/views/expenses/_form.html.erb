<div data-controller="expense-form">
  <%= form_with model: expense, local: true do |form| %>
    <% if expense.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(expense.errors.count, "error") %> prohibited this expense from
  being saved:</h2>
        <ul>
          <% expense.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="field">
      <%= form.label :description %>
      <%= form.text_field :description %>
    </div>

    <div class="field">
      <%= form.label :amount %>
      <%= form.number_field :amount, step: 0.01 %>
    </div>

    <div class="field">
      <%= form.label :date %>
      <%= form.date_field :date %>
    </div>

    <div class="field">
      <%= form.label :paid_by_id, "Paid by" %>
      <%= form.collection_select :paid_by_id, User.all, :id, :name,
                                  { prompt: 'Select who paid' },
                                  { data: {
                                    "expense-form-target": "paidBySelect",
                                    action: "change->expense-form#paidByChanged"
                                  } } %>
    </div>

    <div class="field">
      <%= form.label :user_ids, "Split with:" %>
      <div>
        <% User.all.each do |user| %>
          <div>
            <%= check_box_tag "expense[user_ids][]", user.id, false,
                              id: "expense_user_ids_#{user.id}",
                              data: {
                                "expense-form-target": "userCheckbox",
                                action: "change->expense-form#userCheckboxChanged"
                              } %>
            <%= label_tag "expense_user_ids_#{user.id}", user.name %>
          </div>
        <% end %>
      </div>

      <div data-expense-form-target="warning"
            style="display: none; color: red; font-weight: bold; margin-top: 10px;">
        ⚠️ The person who paid is not included in the split. Is this intentional?
      </div>
    </div> 
    
    <div class="actions">
      <%= form.submit %>
    </div>
  <% end %>
</div>